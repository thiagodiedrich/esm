###############################################################################
# ESM - API Backend
# Copie este arquivo para .env e ajuste os valores para seu ambiente.
###############################################################################

# -----------------------------------------------------------------------------
# Ambiente (GLOBAL)
# -----------------------------------------------------------------------------
NODE_ENV=development

# -----------------------------------------------------------------------------
# Gateway (Node.js / Fastify)
# -----------------------------------------------------------------------------
HOST=0.0.0.0
PORT=3000
SERVICE_NAME=esm-api

# JWT (RS256 ou HS256)
JWT_ALGORITHM=HS256
JWT_SECRET=dev-secret-change-me
SECRET_KEY=change-me-in-production-min-32-chars
JWT_PRIVATE_KEY_PATH=./keys/jwt_private.pem
JWT_PUBLIC_KEY_PATH=./keys/jwt_public.pem

ACCESS_TOKEN_EXPIRE_MINUTES=15

# Rate Limiting
RATE_LIMIT_PER_MINUTE=1000

# CORS (URLs do frontend/dashboard)
CORS_ORIGINS=http://localhost:3000,http://localhost:8080

# Logging (Gateway)
LOG_LEVEL=info

# Audit log global (todas as chamadas)
AUDIT_LOG_ENABLED=true

# Failban (login)
LOGIN_MAX_ATTEMPTS=5
LOGIN_BLOCK_MINUTES=30

# -----------------------------------------------------------------------------
# Shared (Gateway + Workers)
# -----------------------------------------------------------------------------
# Banco de Dados (PostgreSQL / TimescaleDB)
# DATABASE_URL=postgresql://esm:SUA_SENHA@localhost:5432/esm_db
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=esm
POSTGRES_PASSWORD=esm
POSTGRES_DB=control_plane
# DATABASE_URL=postgresql+asyncpg://esm:SUA_SENHA@postgres:5432/control_plane
POSTGRES_DEBUG=false
POSTGRES_LOG_STATEMENT=none
POSTGRES_LOG_DURATION=off

CONTROL_PLANE_DATABASE_URL=postgres://esm:esm@postgres:5432/control_plane

DB_CATALOG__ERP_MAIN=postgres://esm:esm@postgres:5432/erp_main

# Kafka (fila de mensagens - claim check)
KAFKA_ENABLED=false
KAFKA_CLIENT_ID=esm-api
KAFKA_BROKERS=kafka:9092
KAFKA_TOPIC=telemetry.raw
KAFKA_PORT=9092
KAFKA_ADVERTISED_HOST=localhost
KAFKA_KRAFT_CLUSTER_ID=esm-kraft-cluster

# Storage - Claim Check Pattern (MinIO ou Local)
STORAGE_TYPE=minio
MINIO_ENDPOINT=http://minio:9000
MINIO_PORT=9000
MINIO_ACCESS_KEY=esm
MINIO_SECRET_KEY=esmminio
MINIO_BUCKET=telemetry-raw
MINIO_REGION=us-east-1
MINIO_USE_SSL=false
STORAGE_LOCAL_PATH=/app/storage

# Infra local (opcional, para referencia)
REDIS_URL=redis://redis:6379
REDIS_PORT=6379
MINIO_CONSOLE_PORT=9001
MINIO_ROOT_USER=esm
MINIO_ROOT_PASSWORD=esmminio

# -----------------------------------------------------------------------------
# Multi-tenant (Gateway + Workers)
# -----------------------------------------------------------------------------
MULTI_TENANT_ENABLED=false
MULTI_TENANT_ENFORCE=false
TENANT_HEADER=x-tenant-id
ORGANIZATION_HEADER=x-organization-id
WORKSPACE_HEADER=x-workspace-id
DEFAULT_TENANT_SLUG=legacy
DEFAULT_TENANT_NAME=Legacy Tenant

# Planos e Quotas (SaaS / Billing)
DEFAULT_PLAN_CODE=legacy
DEFAULT_PLAN_NAME=Legacy Plan
DEFAULT_PLAN_ITEMS_PER_DAY=
DEFAULT_PLAN_SENSORS_PER_DAY=
DEFAULT_PLAN_BYTES_PER_DAY=
DEFAULT_PLAN_ALERT_DELAY_SECONDS=60
QUOTA_ENABLED=false
QUOTA_ENFORCE=false
QUOTA_ESTIMATE_BYTES=false
BILLING_EVENTS_ENABLED=false

# Alertas / Webhooks (Fase 7)
ALERT_POLL_SECONDS=60
ALERTS_ENABLED=false
WEBHOOKS_ENABLED=false

# White-label (GLOBAL / SaaS)
WHITE_LABEL_ENABLED=false
WHITE_LABEL_DEFAULT_APP_NAME=Easy Smart Monitor
WHITE_LABEL_DEFAULT_LOGO_URL=
WHITE_LABEL_DEFAULT_PRIMARY_COLOR=#0066cc
WHITE_LABEL_DEFAULT_SECONDARY_COLOR=#004499
WHITE_LABEL_DEFAULT_SUPPORT_EMAIL=suporte@exemplo.com
WHITE_LABEL_DEFAULT_SUPPORT_PHONE=
WHITE_LABEL_DEFAULT_DOMAIN=

# -----------------------------------------------------------------------------
# Usuario Master (bootstrap do dashboard)
# -----------------------------------------------------------------------------
MASTER_ADMIN_ENABLED=false
MASTER_ADMIN_NAME=Admin
MASTER_ADMIN_USERNAME=admin
MASTER_ADMIN_PASSWORD=change-me-now
MASTER_ADMIN_EMAIL=admin@localhost
MASTER_ADMIN_TENANT_ID=1
MASTER_ADMIN_ORGANIZATION_ID=1
MASTER_ADMIN_WORKSPACE_ID=1
MASTER_ADMIN_ROLE=[0]

# -----------------------------------------------------------------------------
# Workers Python
# -----------------------------------------------------------------------------
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10

KAFKA_GROUP_ID=telemetry-workers
KAFKA_BATCH_SIZE=100
KAFKA_AUTO_COMMIT=false

BULK_INSERT_BATCH_SIZE=1000
MAX_RETRIES=3
RETRY_DELAY=5
DELETE_FILE_AFTER_PROCESSING=true
FILE_RETENTION_DAYS=7

BILLING_USAGE_ENABLED=false

# Logging (Workers)
LOG_LEVEL=info
LOG_FORMAT=json
DEBUG=false
