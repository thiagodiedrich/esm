###############################################################################
# ESM - API Backend
# Copie este arquivo para .env e ajuste os valores para seu ambiente.
# cp .env.example .env
###############################################################################

# -----------------------------------------------------------------------------
# Ambiente (GLOBAL)
# -----------------------------------------------------------------------------
# Modo de execucao da aplicacao. "development" exibe mais logs; "production"
# otimiza performance.
NODE_ENV=development

# -----------------------------------------------------------------------------
# Gateway (Node.js / Fastify)
# -----------------------------------------------------------------------------
# Endereco em que o Gateway escuta (0.0.0.0 = todas as interfaces; use Docker).
HOST=0.0.0.0
# Porta HTTP em que a API fica disponivel.
PORT=3000
SERVICE_NAME=esm-api

# JWT (RS256 ou HS256)
# [OBRIGATORIO EM PRODUCAO] Use chave longa e aleatoria (min. 32 caracteres).
JWT_ALGORITHM=HS256
JWT_SECRET=dev-change-me-in-production-min-32-chars

# Tempo de vida do access token em minutos (referencia para o gateway).
ACCESS_TOKEN_EXPIRE_MINUTES=15

# Rate Limiting
RATE_LIMIT_PER_MINUTE=1000

# CORS (origens permitidas do frontend — ex.: onde o app React é servido)
# Se o frontend for acessado por https://easytest.simc.com.br, inclua essa URL.
CORS_ORIGINS=http://localhost:3000,http://localhost:8080,https://easytest.simc.com.br

# Failban (login)
LOGIN_MAX_ATTEMPTS=5
LOGIN_BLOCK_MINUTES=30

# Audit log global (todas as chamadas)
AUDIT_LOG_ENABLED=true

# Logging (Gateway)
# Nivel: error | warn | log | debug | verbose (info = log). Producao: log ou warn.
LOG_LEVEL=log
LOG_FORMAT=json
DEBUG=false

# Swagger / OpenAPI
SWAGGER_ENABLED=true
SWAGGER_PATH=docs
SWAGGER_TITLE=ESM API
SWAGGER_DESCRIPTION=Documentacao da API do ESM
SWAGGER_VERSION=1.7.0
# Swagger/OpenAPI atras de proxy HTTPS (URL publica)
SWAGGER_SERVER_URL=

# -----------------------------------------------------------------------------
# Shared (Gateway + Workers)
# -----------------------------------------------------------------------------
# Banco de Dados (PostgreSQL / TimescaleDB)
# [OBRIGATORIO EM PRODUCAO] Configure DATABASE_URL OU POSTGRES_* corretamente.
# DATABASE_URL=postgresql://esm:SUA_SENHA@localhost:5432/esm_db
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=esm
POSTGRES_PASSWORD=esm
POSTGRES_DB=control_plane
# Para Workers Python: a URL deve usar o driver asyncpg
# DATABASE_URL=postgresql+asyncpg://esm:SUA_SENHA@postgres:5432/control_plane
# Debug do PostgreSQL (loga query e retorno com dados sensiveis mascarados)
POSTGRES_DEBUG=false
# Logs do PostgreSQL (no container do banco)
# none | ddl | mod | all
POSTGRES_LOG_STATEMENT=none
# on | off
POSTGRES_LOG_DURATION=off
# Loga queries acima do tempo informado (ms). Use 0 para tudo, -1 para desativar.
# Dica: se POSTGRES_DEBUG=true, use 0.
POSTGRES_LOG_MIN_DURATION_STATEMENT=-1

# URL usada pelo backend (Control Plane)
CONTROL_PLANE_DATABASE_URL=postgres://esm:esm@postgres:5432/control_plane

# Catalogo Multi-DB (por tenant)
# - tenants.*_db guarda o sufixo logico
# - Exemplo: tenants.erp_db = ERP_MAIN
DB_CATALOG__ERP_MAIN=postgres://esm:esm@postgres:5432/erp_main

# Kafka (fila de mensagens - claim check)
# [OBRIGATORIO EM PRODUCAO]
KAFKA_ENABLED=false
KAFKA_CLIENT_ID=esm-api
KAFKA_BROKERS=kafka:9092
KAFKA_TOPIC=telemetry.raw
KAFKA_PORT=9092
KAFKA_ADVERTISED_HOST=localhost
KAFKA_KRAFT_CLUSTER_ID=esm-kraft-cluster

# Storage - Claim Check Pattern (MinIO ou Local)
# [OBRIGATORIO EM PRODUCAO] Configure credenciais e bucket.
STORAGE_TYPE=minio
MINIO_ENDPOINT=http://minio:9000
MINIO_PORT=9000
MINIO_ACCESS_KEY=esm
MINIO_SECRET_KEY=esmminio
MINIO_BUCKET=telemetry-raw
MINIO_REGION=us-east-1
MINIO_USE_SSL=false
STORAGE_LOCAL_PATH=/app/storage
# Rate limit opcional para download interno (por minuto, 0 = desabilitado).
STORAGE_DOWNLOAD_RATE_LIMIT_PER_MINUTE=0

# Infra local (opcional, para referencia)
REDIS_URL=redis://redis:6379
REDIS_PORT=6379
MINIO_CONSOLE_PORT=9001
MINIO_ROOT_USER=esm
MINIO_ROOT_PASSWORD=esmminio

# -----------------------------------------------------------------------------
# Workers Python
# -----------------------------------------------------------------------------
# Banco de dados (pool)
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10

# Kafka (consumer)
KAFKA_GROUP_ID=telemetry-workers
KAFKA_BATCH_SIZE=100
KAFKA_AUTO_COMMIT=false

# Processamento
BULK_INSERT_BATCH_SIZE=1000
MAX_RETRIES=3
RETRY_DELAY=5
DELETE_FILE_AFTER_PROCESSING=true
FILE_RETENTION_DAYS=7

# Observabilidade / Billing (Workers)
# Registra uso diario por tenant na tabela tenant_usage_metrics.
BILLING_USAGE_ENABLED=false

# -----------------------------------------------------------------------------
# Multi-tenant (Gateway + Workers)
# -----------------------------------------------------------------------------
MULTI_TENANT_ENABLED=false
# Usa TENANT_DEFAULT_ID quando multi-tenant esta desligado (login e contexto).
TENANT_DEFAULT_ENABLED=false
# Se true, bloqueia requisicoes sem tenant_id (use somente apos migracao completa).
MULTI_TENANT_ENFORCE=false
# Headers opcionais (se nao estiver no JWT). Ex.: x-tenant-id no /auth/login.
TENANT_HEADER=x-tenant-id
ORGANIZATION_HEADER=x-organization-id
WORKSPACE_HEADER=x-workspace-id

# Planos e Quotas (SaaS / Billing)
# [OBRIGATORIO EM PRODUCAO] se voce for aplicar limites por plano.
DEFAULT_PLAN_BOOTSTRAP_ENABLED=false
DEFAULT_PLAN_CODE=legacy
DEFAULT_PLAN_NAME=Legacy Plan
DEFAULT_PLAN_ITEMS_PER_DAY=
DEFAULT_PLAN_SENSORS_PER_DAY=
DEFAULT_PLAN_BYTES_PER_DAY=
# Atraso padrao de alertas por plano (segundos). Ex.: 60 = 1 min.
DEFAULT_PLAN_ALERT_DELAY_SECONDS=60
# Ativa enforcement de quotas na ingestao.
QUOTA_ENABLED=false
QUOTA_ENFORCE=false
# Se true, calcula bytes da requisicao (pode ser custoso).
QUOTA_ESTIMATE_BYTES=false
# Registra eventos de billing (ex.: quota excedida).
BILLING_EVENTS_ENABLED=false

# White-label (GLOBAL / SaaS)
# [OBRIGATORIO EM PRODUCAO] apenas se oferecer white-label.
TENANT_WHITE_LABEL_ENABLED=false
# Configuracao padrao (fallback quando tenant nao tem branding proprio).
TENANT_WHITE_LABEL_DEFAULT_APP_NAME=ESM
TENANT_WHITE_LABEL_DEFAULT_LOGO_URL=
TENANT_WHITE_LABEL_DEFAULT_PRIMARY_COLOR=#0066cc
TENANT_WHITE_LABEL_DEFAULT_SECONDARY_COLOR=#004499
TENANT_WHITE_LABEL_DEFAULT_SUPPORT_EMAIL=suporte@exemplo.com
TENANT_WHITE_LABEL_DEFAULT_SUPPORT_PHONE=
TENANT_WHITE_LABEL_DEFAULT_DOMAIN=

# Defaults para bootstrap (usados se tenant/org/workspace nao existirem)
TENANT_DEFAULT_ID=1
TENANT_DEFAULT_SLUG=default-tenant
TENANT_DEFAULT_NAME=DEFAULT TENANT
TENANT_DEFAULT_ORGANIZATION_ID=1
TENANT_DEFAULT_ORGANIZATION_NAME=DEFAULT ORGANIZATION
TENANT_DEFAULT_WORKSPACE_ID=1
TENANT_DEFAULT_WORKSPACE_NAME=DEFAULT WORKSPACE

# -----------------------------------------------------------------------------
# Usuario Master (bootstrap do dashboard)
# -----------------------------------------------------------------------------
# Use apos a instalacao para criar o admin global do sistema (tenant_id=0).
# [OBRIGATORIO EM PRODUCAO] se quiser bootstrap automatico.
TENANT_MASTER_ADMIN_ENABLED=false
TENANT_MASTER_ADMIN_NAME=Admin
TENANT_MASTER_ADMIN_USERNAME=admin
TENANT_MASTER_ADMIN_PASSWORD=change-me-now
TENANT_MASTER_ADMIN_EMAIL=admin@localhost
TENANT_MASTER_ADMIN_TENANT_ID=1
TENANT_MASTER_ADMIN_ORGANIZATION_ID=1
TENANT_MASTER_ADMIN_WORKSPACE_ID=1
TENANT_MASTER_ADMIN_ROLE=[0]

# Alertas / Webhooks (Fase 7)
# Intervalo global do cron (segundos). Pode ser sobrescrito por tenant/plano.
ALERT_POLL_SECONDS=60
ALERTS_ENABLED=false
WEBHOOKS_ENABLED=false